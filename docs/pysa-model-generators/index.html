<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">Dynamically Generating Models | Pyre</title><meta data-react-helmet="true" property="og:image" content="https://pyre-check.org/img/docusaurus.png"><meta data-react-helmet="true" property="twitter:image" content="https://pyre-check.org/img/docusaurus.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Pyre"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Dynamically Generating Models | Pyre"><meta data-react-helmet="true" name="description" content="Some sources and sinks may be too numerous or too rapidly changing for defining"><meta data-react-helmet="true" property="og:description" content="Some sources and sinks may be too numerous or too rapidly changing for defining"><meta data-react-helmet="true" property="og:url" content="https://pyre-check.org/docs/pysa-model-generators"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pyre-check.org/docs/pysa-model-generators"><link rel="stylesheet" href="/styles.42c8ac0d.css">
<link rel="preload" href="/styles.c360b284.js" as="script">
<link rel="preload" href="/runtime~main.821168a2.js" as="script">
<link rel="preload" href="/main.87f24ed0.js" as="script">
<link rel="preload" href="/1.6f9ebafe.js" as="script">
<link rel="preload" href="/2.df8bcc5c.js" as="script">
<link rel="preload" href="/25.d01ea1f6.js" as="script">
<link rel="preload" href="/26.0a90f659.js" as="script">
<link rel="preload" href="/20ac7829.e4b92880.js" as="script">
<link rel="preload" href="/776f3946.079d1fd8.js" as="script">
</head>
<body>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/integrated_logo_light.png" alt="Pyre Logo"></a><a class="navbar__item navbar__link" href="/docs/getting-started">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/pyre-check" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/integrated_logo_light.png" alt="Pyre Logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started">Documentation</a></li><li class="menu__list-item"><a href="https://github.com/facebook/pyre-check" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Pyre</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gradual-typing">Gradual Typing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/error-suppression">Error Suppression</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/error-types">Error Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/lsp-integration">Editor Integration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/querying-pyre">Querying Pyre</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Pysa</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-basics">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-running">Running Pysa</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-features">Feature Annotations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-advanced">Advanced Topics</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/pysa-model-generators">Dynamically Generating Models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-tips">Development Tips</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-coverage">Coverage Increasing Strategies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/static-analysis-post-processor">Static Analysis Processor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-additional-resources">Additional Resources</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Dynamically Generating Models</h1></header><div class="markdown"><p>Some sources and sinks may be too numerous or too rapidly changing for defining
them statically to be practical. For these scenarios, Pysa has the concept of
model generators, which can generate taint stubs by reading the project&#x27;s source code before static analysis is
started. The current set of model generators is stored in
<a href="https://github.com/facebook/pyre-check/tree/master/tools/generate_taint_models" target="_blank" rel="noopener noreferrer"><code>tools/generate_taint_models</code></a>
within the pyre-check repository.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="running-model-generators"></a>Running Model Generators<a aria-hidden="true" tabindex="-1" class="hash-link" href="#running-model-generators" title="Direct link to heading">#</a></h2><p>The majority of model generators require access to a running environment. For
example, the <code>RESTApiSourceGenerator</code> needs to be able to access <code>urlpatterns</code>
configured for Django, meaning it has to import (and implicitly run) the file
you use to configure routing. The recommended way to run model generators is to set
up a small script within your repository that can run within the virtual
environment for your project. <strong><a href="https://github.com/facebook/pyre-check/tree/master/pysa_tutorial/exercise4" target="_blank" rel="noopener noreferrer">This tutorial
exercise</a>
provides an example of how to setup and use model generators.</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-model-generators"></a>Example Model Generators<a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-model-generators" title="Direct link to heading">#</a></h2><p>The set of model generators is always changing, but below are some examples of
model generators which are currently provided out of the box with Pysa.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="restapisourcegenerator"></a><a href="https://github.com/facebook/pyre-check/blob/master/tools/generate_taint_models/get_REST_api_sources.py"><code>RESTApiSourceGenerator</code></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#restapisourcegenerator" title="Direct link to heading">#</a></h3><p>This model generator is intended to taint all arguments to <a href="https://docs.djangoproject.com/en/2.2/topics/http/views/" target="_blank" rel="noopener noreferrer">Django view
functions</a> as
<code>UserControlled</code>. This is useful when you have views that receive
user-controlled data as arguments separate from the <code>HttpRequest</code> parameter,
such as when <a href="https://docs.djangoproject.com/en/2.2/topics/http/urls/#example" target="_blank" rel="noopener noreferrer">capturing values from the request
path</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="exitnodegenerator"></a><a href="https://github.com/facebook/pyre-check/blob/master/tools/generate_taint_models/get_exit_nodes.py"><code>ExitNodeGenerator</code></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#exitnodegenerator" title="Direct link to heading">#</a></h3><p>This generator is intended to taint all data returned from <a href="https://docs.djangoproject.com/en/2.2/topics/http/views/" target="_blank" rel="noopener noreferrer">Django view
functions</a> as
<code>ReturnedToUser</code>. This is useful when you have decorators which allow your view
functions to return raw python types, rather than <code>HttpResponse</code> objects. Note
that you do not need this generator if you always construct <code>HttpResponse</code>
objects, because they are already annotated as <code>ReturnedToUser</code> sinks.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="graphqlsourcegenerator"></a><a href="https://github.com/facebook/pyre-check/blob/master/tools/generate_taint_models/get_graphql_sources.py"><code>GraphQLSourceGenerator</code></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#graphqlsourcegenerator" title="Direct link to heading">#</a></h3><p>This model generator is similar to the <code>RESTApiSourceGenerator</code> and
<code>ExitNodeGenerator</code> discussed above, but it is intended to generate stubs with
<code>UserControlled</code> and <code>ReturnedToUser</code> annotations for graphene-style GraphQL
<code>resolver</code> functions.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="annotatedfreefunctionwithdecoratorgenerator"></a><a href="https://github.com/facebook/pyre-check/blob/master/tools/generate_taint_models/get_annotated_free_functions_with_decorator.py"><code>AnnotatedFreeFunctionWithDecoratorGenerator</code></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#annotatedfreefunctionwithdecoratorgenerator" title="Direct link to heading">#</a></h3><p>This model generator provides general purpose functionality to annotate all free
functions which have a given decorator. The annotations can be used to mark any
of the function&#x27;s arguments or return types as sources, sinks, features, etc.
This is useful whenever you have a function which modifies taint analysis
expectations. For example, if you had a decorator which applies rate limiting to
functions, you could use this model generator to add a feature to all flow passing
through rate limited functions, to enable you to filter them out from a given
rule.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="writing-model-generators"></a>Writing Model Generators<a aria-hidden="true" tabindex="-1" class="hash-link" href="#writing-model-generators" title="Direct link to heading">#</a></h2><p>All model generator code lives in
<a href="https://github.com/facebook/pyre-check/tree/master/tools/generate_taint_models" target="_blank" rel="noopener noreferrer"><code>tools/generate_taint_models</code></a>
within the pyre-check repository.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="adding-a-new-model-generator"></a>Adding a new model generator<a aria-hidden="true" tabindex="-1" class="hash-link" href="#adding-a-new-model-generator" title="Direct link to heading">#</a></h3><p><a href="https://github.com/facebook/pyre-check/commit/ea900c5e77d4c6d951e9c42b7310613f7f6edf08#diff-9ef72470683730531933e74a50ea98a1" target="_blank" rel="noopener noreferrer">This commit</a>
provides an example of how to add a new model generator.</p><p>The basic workflow is:</p><ol><li>Create a new file under <code>generate_taint_models</code> of the form <code>get_&lt;pattern of model&gt;</code>.</li><li>Write a class that inherits from <a href="https://github.com/facebook/pyre-check/blob/master/tools/generate_taint_models/model_generator.py">ModelGenerator</a>.</li><li>Collect all the callables you&#x27;re interested in modeling via <code>gather_functions_to_model</code>.</li><li>Convert the callables you&#x27;ve collected into models. The <a href="https://github.com/facebook/pyre-check/blob/master/tools/generate_taint_models/model.py">CallableModel</a> class is a convenience that pretty prints things in the right way - you just need to specify what kind of taint the parameters and return value should have, specify the callable to model, and call generate().</li><li>Register your class in the registry (<a href="https://github.com/facebook/pyre-check/blob/922410239404aa436691754402b0c3db68c5a46f/tools/generate_taint_models/get_graphql_sources.py#L73-L75">example</a>).</li><li>Write unit tests (<a href="https://github.com/facebook/pyre-check/blob/922410239404aa436691754402b0c3db68c5a46f/tools/generate_taint_models/tests/get_annotated_free_functions_with_decorator_test.py">example</a>).</li><li>Import your new class in the <code>__init__</code> file (<a href="https://github.com/facebook/pyre-check/blob/922410239404aa436691754402b0c3db68c5a46f/tools/generate_taint_models/__init__.py#L7">example</a>).</li></ol></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/pysa-advanced"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Advanced Topics</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/pysa-tips"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Development Tips »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#running-model-generators" class="table-of-contents__link">Running Model Generators</a></li><li><a href="#example-model-generators" class="table-of-contents__link">Example Model Generators</a><ul><li><a href="#restapisourcegenerator" class="table-of-contents__link">RESTApiSourceGenerator</a></li><li><a href="#exitnodegenerator" class="table-of-contents__link">ExitNodeGenerator</a></li><li><a href="#graphqlsourcegenerator" class="table-of-contents__link">GraphQLSourceGenerator</a></li><li><a href="#annotatedfreefunctionwithdecoratorgenerator" class="table-of-contents__link">AnnotatedFreeFunctionWithDecoratorGenerator</a></li></ul></li><li><a href="#writing-model-generators" class="table-of-contents__link">Writing Model Generators</a><ul><li><a href="#adding-a-new-model-generator" class="table-of-contents__link">Adding a new model generator</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1Wg7"><img class="footer__logo" alt="Facebook Open Source Logo" src="https://docusaurus.io/img/oss_logo.png"></a></div><div>Copyright &#169; 2020 Facebook, Inc.</div></div></div></footer></div>
<script src="/styles.c360b284.js"></script>
<script src="/runtime~main.821168a2.js"></script>
<script src="/main.87f24ed0.js"></script>
<script src="/1.6f9ebafe.js"></script>
<script src="/2.df8bcc5c.js"></script>
<script src="/25.d01ea1f6.js"></script>
<script src="/26.0a90f659.js"></script>
<script src="/20ac7829.e4b92880.js"></script>
<script src="/776f3946.079d1fd8.js"></script>
</body>
</html>